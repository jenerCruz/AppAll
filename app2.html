<!DOCTYPE html>
<html lang="es" class="h-full bg-slate-100">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Panel de Ventas y Metas — PWA</title>

  <!-- Tailwind local (asegúrate de compilarlo y guardarlo en assets/css/tailwind.min.css) -->
  <link rel="stylesheet" href="./assets/css/tailwind.min.css">

  <!-- Manifest -->
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#0ea5e9">

  <!-- Lucide icons local UMD -->
  <script src="./assets/js/lucide.min.js"></script>

  <style>
    /* Estilos de la PWA */
    body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    .tab-btn { padding: .6rem 1rem; font-weight: 500; color: #6b7280; border-bottom: 2px solid transparent; border-radius: .375rem .375rem 0 0; }
    .tab-btn.active { color:#0ea5e9; border-bottom-color:#0ea5e9; }
    .tab-content { padding: 1rem; background: white; border-radius:.5rem; box-shadow: 0 1px 4px rgba(2,6,23,.04); }
    #toast { transition: transform 0.3s ease-out, opacity 0.3s ease-out; }
    @media (max-width: 640px) {
        .mobile-col { flex-direction: column; }
    }
  </style>

  <!-- Chart.js para gráficos -->
  <script src="./assets/js/chart.umd.min.js"></script>
</head>
<body class="h-full">

  <div class="min-h-full">
    <header class="bg-white shadow">
      <!-- ... (Tu HTML de cabecera) ... -->
      <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
        <h1 class="text-xl font-bold text-gray-900">
          Ventas & Metas
        </h1>
        <span id="db-status" class="text-sm font-medium text-green-400">BD Desconectada</span>
      </div>
    </header>

    <main>
      <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <!-- Pestañas -->
        <div class="border-b border-gray-200 mb-6">
          <nav class="-mb-px flex space-x-8" aria-label="Tabs">
            <button id="tab-btn-dashboard" class="tab-btn active" onclick="showTab('dashboard')">Dashboard</button>
            <button id="tab-btn-venta" class="tab-btn" onclick="showTab('venta')">Registrar Venta</button>
            <button id="tab-btn-promotores" class="tab-btn" onclick="showTab('promotores')">Promotores</button>
            <button id="tab-btn-metas" class="tab-btn" onclick="showTab('metas')">Metas</button>
            <button id="tab-btn-config" class="tab-btn" onclick="showTab('config')">Configuración</button>
            <button id="tab-btn-sincro" class="tab-btn" onclick="showTab('sincro')">Sincronización</button>
          </nav>
        </div>

        <!-- Dashboard Content -->
        <!-- ... (Contenido de pestañas: dashboard, venta, promotores, metas, config, sincro) ... -->
        <div id="dashboard" class="tab-content">
            <h2 class="text-lg font-semibold mb-4">Resumen de Metas y Ventas del Mes</h2>
            
            <div id="sucursal-cards-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6">
                <!-- Tarjetas de sucursales se insertan aquí -->
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white p-4 rounded-lg shadow border">
                    <h3 class="font-semibold mb-3">Ventas vs. Metas por Producto</h3>
                    <div class="h-64">
                        <canvas id="barChart"></canvas>
                    </div>
                </div>
                
                <div class="bg-white p-4 rounded-lg shadow border flex mobile-col justify-around items-center">
                    <div class="relative w-40 h-40">
                        <canvas id="donutChart"></canvas>
                        <div id="donut-percentage" class="absolute inset-0 flex items-center justify-center text-2xl font-bold text-blue-600">
                            0%
                        </div>
                    </div>
                    <div>
                        <h3 class="font-semibold">Progreso General del Mes</h3>
                        <p class="text-sm text-slate-500">Total de unidades vendidas vs meta.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Pestaña Registrar Venta -->
        <div id="venta" class="tab-content hidden">
            <h2 class="text-lg font-semibold mb-4">Registrar Nueva Venta</h2>
            <form id="form-ventas" class="space-y-4">
                <input type="date" id="venta-fecha" class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
                <select id="venta-sucursal" class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" required></select>
                <select id="venta-producto" class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" required></select>
                <select id="venta-promotor" class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" required></select>
                <input type="number" id="venta-cantidad" placeholder="Cantidad Vendida" class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" required min="1">
                <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-150">Guardar Venta</button>
            </form>

            <h3 class="text-md font-semibold mt-8 mb-3 border-t pt-4">Historial de Ventas</h3>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Fecha</th>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Sucursal</th>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Producto</th>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Cantidad</th>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Promotor</th>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Acción</th>
                        </tr>
                    </thead>
                    <tbody id="lista-ventas" class="bg-white divide-y divide-gray-200">
                        <tr><td colspan="6" class="text-center py-4 text-slate-500">Cargando...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Pestaña Promotores -->
        <div id="promotores" class="tab-content hidden">
            <h2 class="text-lg font-semibold mb-4">Gestión de Promotores</h2>
            <form id="form-promotores" class="flex space-x-4 mb-6">
                <input type="text" id="promotor-nombre" placeholder="Nombre del Promotor" class="flex-grow border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
                <!-- Se reutiliza venta-sucursal para promotor, pero es mejor tener uno dedicado: -->
                <select id="promotor-sucursal" class="w-1/3 border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
                    <option value="">Selecciona Sucursal</option>
                    <option value="Coppel 363">Coppel 363</option>
                    <option value="Coppel 385">Coppel 385</option>
                    <!-- ... añadir todas las sucursales aquí para el formulario de promotores ... -->
                    <option value="Coppel 716">Coppel 716</option>
                    <option value="Elektra 218">Elektra 218</option>
                    <option value="Chedraui 23">Chedraui 23</option>
                    <option value="Chedraui 99">Chedraui 99</option>
                    <option value="Chedraui 105">Chedraui 105</option>
                </select>
                <button type="submit" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-150">Agregar</button>
            </form>

            <h3 class="text-md font-semibold mt-8 mb-3 border-t pt-4">Lista de Promotores</h3>
            <div id="lista-promotores" class="space-y-2 max-h-96 overflow-y-auto">
                <p class="text-slate-500">Cargando...</p>
            </div>
        </div>

        <!-- Pestaña Metas -->
        <div id="metas" class="tab-content hidden">
            <h2 class="text-lg font-semibold mb-4">Establecer Meta Mensual</h2>
            <form id="form-metas" class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6 items-end">
                <select id="meta-mes" class="col-span-1 border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" required></select>
                <select id="meta-sucursal" class="col-span-1 border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" required></select>
                <select id="meta-producto" class="col-span-1 border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" required></select>
                <input type="number" id="meta-meta" placeholder="Cantidad Meta" class="col-span-1 border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" required min="1">
                <button type="submit" class="col-span-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition duration-150">Guardar Meta</button>
            </form>

            <h3 class="text-md font-semibold mt-8 mb-3 border-t pt-4">Metas Establecidas</h3>
            <div class="overflow-x-auto max-h-96 overflow-y-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Mes</th>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Sucursal</th>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Producto</th>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Meta</th>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Acción</th>
                        </tr>
                    </thead>
                    <tbody id="lista-metas" class="bg-white divide-y divide-gray-200">
                        <tr><td colspan="5" class="text-center py-4 text-slate-500">Cargando...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Pestaña Configuración -->
        <div id="config" class="tab-content hidden">
            <h2 class="text-lg font-semibold mb-4">Configuración de Sincronización (Gist)</h2>
            <p class="text-sm text-slate-600 mb-4">Introduce tu ID de Gist y un Token personal de GitHub para habilitar la sincronización de datos.</p>
            
            <form id="form-gist-config" class="space-y-4">
                <div>
                    <label for="gist-id" class="block text-sm font-medium text-gray-700">Gist ID</label>
                    <input type="text" id="gist-id" placeholder="e.g., 1234abcd5678efgh" class="w-full mt-1 border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label for="gist-token" class="block text-sm font-medium text-gray-700">GitHub Personal Access Token</label>
                    <input type="password" id="gist-token" placeholder="Introduce tu token aquí" class="w-full mt-1 border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
                    <p class="text-xs text-red-500 mt-1">Requiere permiso "gist" para lectura/escritura.</p>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-150">Guardar Configuración</button>
            </form>
        </div>
        
        <!-- Pestaña Sincronización -->
        <div id="sincro" class="tab-content hidden">
            <h2 class="text-lg font-semibold mb-4">Sincronización de Datos</h2>
            <p class="text-sm text-slate-600 mb-6">Utiliza estas opciones para sincronizar tu base de datos local con el Gist de GitHub configurado.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Sincronizar DESDE Gist (Descargar) -->
                <div class="p-4 border rounded-lg bg-red-50 border-red-200">
                    <h3 class="font-semibold text-red-700 mb-2">Descargar (Gist → Local)</h3>
                    <p class="text-sm text-red-600 mb-4">CUIDADO: **Sobrescribe** todos los datos locales con el contenido del Gist.</p>
                    <button onclick="syncFromGist()" class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition duration-150">Sincronizar DESDE Gist</button>
                </div>
                
                <!-- Sincronizar HACIA Gist (Subir) -->
                <div class="p-4 border rounded-lg bg-green-50 border-green-200">
                    <h3 class="font-semibold text-green-700 mb-2">Subir (Local ⇄ Gist)</h3>
                    <p class="text-sm text-green-600 mb-4">Fusiona los datos locales con los datos remotos antes de subir (recomendado).</p>
                    <button onclick="syncToGist()" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition duration-150">Sincronizar HACIA Gist</button>
                </div>
            </div>
        </div>
        
      </div>
    </main>

    <!-- Toast Notification (Mensajes flotantes) -->
    <div id="toast" class="fixed bottom-0 right-0 m-4 p-3 rounded-lg shadow-xl text-white opacity-0 translate-y-10" role="alert">
        <span id="toast-message">Mensaje de prueba</span>
    </div>
  </div>

  <!-- Scripts JavaScript: SOLO archivos externos -->
  <!-- ¡IMPORTANTE! Solo mantenemos la referencia a App.js -->
  <script src="Assets/Js/App.js"></script> 
</body>
</html>

